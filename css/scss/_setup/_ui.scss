/* Force the clock to be visible and sized */
.mg-clock { /* position now set inline; keep other styles */
	pointer-events: auto;
	font-size: 13px;
	color: $white;
	z-index: 53;

	&.readonly {

		.mg-clock-name {
			pointer-events: none;
			border: none;
			background: transparent;
			opacity: 0.95;

			&:hover,
			&:focus {
				border: none;
				box-shadow: none;
			}
		}

		.mg-clock-controls {
			display: none;
		}
	}

	.mg-clock-badge,
	.mg-clock-count {
		font-weight: 700;
		opacity: 0.9;
		@include oswald();
		font-size: 1.5rem;
		letter-spacing: .05em;
		display: flex;
		flex-direction: column;
		text-align: center;
		line-height: 1;
		gap: .25rem;

		.clock-small {
			font-size: .75rem;
			color: $mg-blue-2;
			letter-spacing: .25em;
		}
	}

	.mg-clock-badge {
		display: none;
	}

	&.mg-collapsed {
		.mg-clock-visual,
		.main-controls {
			display: none !important;
		}

		.mg-clock-inner {
			cursor: pointer; /* mirrors Foundry's "clickable header" vibe */

			.mg-clock-name {
				text-align: left;
				width: 90%;
			}

			.mg-clock-badge {
				display: block;
				width: 90%;
				text-align: left;
				padding: 0 .625rem 0 0;
			}

			.mg-clock-controls {
				width: 90%;
				margin: 0;

				.add-remove button {
					margin-top: .625rem;
				}
			}
		}
	}

	&.mg-dragging .mg-clock-inner {
		box-shadow: 0 4px 16px rgba(0,0,0,0.35);
	}

	.mg-clock-inner {
		display: flex; 
		align-items: center; 
		flex-direction: column;
		padding-bottom: .625rem;
		gap: 0;
		flex-wrap: wrap;
		background: rgba($mg-blue-4, .45);
		@include mg-border();
		border-radius: .625rem;
		backdrop-filter: blur(4px);
		box-shadow: 0 2px 12px rgba(0,0,0,0.25);

		.mg-clock-grip {
			width: 100%;
			height: 1rem;
			border-radius: 0.625rem .625rem 0 0;
			margin-bottom: .5rem;
			align-self: center;
			cursor: grab;
			background: $mg-blue-main-2;
			opacity: 0.6;

			&:active { 
				cursor: grabbing; 
				opacity: 0.9; 
			}
		}

		.mg-clock-name {
			background: transparent;
			@include mg-border();
			color: inherit;
			width: 100%;
			border: none;
			@include oswald();
			font-size: 1.25rem;
			text-transform: uppercase;
			font-style: italic;
			font-weight: 700;
			transition: text-shadow .5s ease;
			padding-left: 0;
			padding-right: 0;
			text-align: center;
			text-shadow: none;

			&:hover,
			&:focus {
				text-shadow: $mg-blue-1 1px 0 10px;
				box-shadow: none;
				outline: none;
			}
		}

		.mg-clock-visual { 
			position: relative; 
			width: 120px; 
			height: 120px; 

			.mg-clock-svg { 
				display: block; 
				width: 120px; 
				height: 120px; 
			}

			path.seg.on  { stroke: var(--mg-clock-on,  $mg-blue-3); stroke-linecap: round; stroke-width: 12; fill: none; }
			path.seg.off { stroke: var(--mg-clock-off, $mg-blue-4);  stroke-linecap: round; stroke-width: 12; fill: none; opacity: .75; }

			.mg-clock-center {
				position: absolute;
				inset: 37% 34%; 
				display: grid; 
				place-items: center;
				font-weight: 700; 
				text-shadow: 0 1px 2px rgba(0,0,0,0.6);
			}

			.mg-handle-scale {
				transition: transform 0.5s ease;
				transform-origin: 0 0;
			}
		}

		.mg-clock-controls { 
			display: flex; 
			align-items: center; 
			flex-wrap: wrap;
			gap: 0.625rem;
			margin: 0 0.625rem; 

			button {
				width: 24px; 
				height: 100%;
				margin: 0;
				display: flex;
				align-items: center;

				&:first-of-type {
					border-radius: 0.625rem 0 0 0.625rem;
				}
				
				&:last-of-type {
					border-radius: 0 0.625rem 0.625rem 0;
				}
			}

			.main-controls {
				display: flex;
				align-items: center;
				width: 100%;
			}

			.add-remove {
				display: flex !important;
				width: 100%;
				gap: .625rem;

				button {
					width: 50%;
					padding: .25rem;
					border-radius: .625rem;
					display: flex;
					justify-content: center;
				}
			}
		}
	}
}

/* On Screen Initiative
----------------------------------------------------------------------*/

.mg-initiative-bar {
	background: rgba($mg-blue-4, .45);
	position: fixed;
	left: 50%;
	bottom: 16px;
	transform: translateX(-50%);
	z-index: 80;
	pointer-events: auto;
	/* Nice container look (keeps your existing inner styles) */
	padding: .5rem;
	border-radius: 12px;
	background: linear-gradient(180deg, rgba(20,24,34,.85), rgba(12,14,20,.85));
	backdrop-filter: blur(6px);
	box-shadow: 0 4px 24px rgba(0,0,0,.35);
	

	.mg-initiative-root {
		display: flex;
		gap: 2rem;
	}

	.window-content {
		padding: .625rem;
		background: rgba($mg-blue-4, .45) !important;
	}

	.mg-initiative-root{

		.mg-bar-header {
			display: flex; 
			flex-direction: column;
			align-items: center; 
			gap: .5rem; 
			margin-bottom: .5rem;

			.mg-left { 
				display:flex; 
				align-items:center; 
				gap:.5rem; 
			}
		}

		.mg-strip {
			display: flex; 
			gap: .35rem; 
			align-items: stretch;
		}

		.mg-slot {
			width: 5rem;
			overflow: hidden; 
			transition: transform .25s ease, opacity .25s ease;
			margin-right: -1.5rem;


			&.is-active { outline: 2px solid var(--color-accent); }

			.mg-art {
				width: 100%;
				height: 5rem;
				overflow: hidden;
				/* crop to a forward-leaning parallelogram */
				--lean: 35%;
				clip-path: polygon(0 0, calc(100% - var(--lean)) 0, 100% 100%, var(--lean) 100%);
				-webkit-clip-path: polygon(0 0, calc(100% - var(--lean)) 0, 100% 100%, var(--lean) 100%);

				img {
					display: block;
					width: 100%;
					height: 100%;
					object-fit: cover;
				}
			}

			.mg-name { 
				@include oswald();
				text-transform: uppercase;
				font-style: italic;
				font-weight: 700;
				letter-spacing: -0.03rem;
				font-size: .75rem;
				text-align:left; 
				white-space:nowrap; 
				overflow:hidden; 
				text-overflow:ellipsis;
				color: $mg-ivory;
				margin-bottom: .5rem;
			}
		}

		/* slide-out for the first slot when ending turn */
		.mg-slot.mg-slide-out {
			transform: translateY(12px);
			opacity: 0.0;
		}
	}
}

/* MG: hide core Combat UI when setting is enabled â€” CSS fallback */
body.system-midnight-gambit[data-hide-core-combat="true"] {
  .sidebar-tabs .item[data-tab="combat"],
  .sidebar .tab[data-tab="combat"] {
    display: none !important;
  }
}

/* existing (you likely already have this; keep it) */
.mg-initiative-root .mg-slot.mg-slide-out {
  transition: transform .35s ease, opacity .35s ease;
  transform: translateY(12px);
  opacity: 0;
}

/* NEW: slide-in keyframes for the last slot after rotation */
@keyframes mg-slide-in {
  from { transform: translateY(-12px); opacity: 0; }
  to   { transform: translateY(0);     opacity: 1; }
}
.mg-initiative-root .mg-slot.mg-slide-in {
  animation: mg-slide-in .35s ease;
}


/* Pointer Event Resets
----------------------------------------------------------------------*/

.mg-clock .mg-clock-center { pointer-events: none; }
.mg-clock .mg-handle-img   { pointer-events: none; }
.mg-clock .mg-clock-visual { cursor: pointer; }
.mg-clock.readonly .mg-clock-visual { cursor: default; }
.mg-clock.readonly .mg-clock-controls { display: none !important; }

.mg-clock .clock-major { font-size: 28px; line-height: 1; font-weight: 800; }
.mg-clock .clock-small { font-size: 12px; opacity: 0.85; margin-left: 2px; }
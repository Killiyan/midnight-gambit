<form class="sheet actor" data-actor-id="{{actor._id}}" autocomplete="off">

  <nav class="sheet-tabs floating" data-group="main">
    <a class="item" data-tab="general"><i class="fas fa-user"></i> <span>General</span></a>
    <a class="item" data-tab="moves"><i class="fa-solid fa-dagger"></i> <span>Moves</span></a>
    <a class="item" data-tab="gambits"><i class="fa-solid fa-cards"></i> <span>Gambits</span></a>
    <a class="item" data-tab="inventory"><i class="fa-solid fa-treasure-chest"></i> <span>Inventory</span></a>
    <a class="item" data-tab="journal"><i class="fa-solid fa-book-open-cover"></i> <span>Journal</span></a>
    <a class="item" data-tab="settings"><i class="fa-solid fa-gears"></i> <span>Settings</span></a>
  </nav>

  <div class="sheet-body">

    <div class="character-info">

      <div class="personal-info">
        <div class="name">
          <!-- Character header title with edit button -->
          <div class="mg-name-wrap" data-mg-nameblock>
            <h1 class="mg-name-view">{{actor.name}}</h1>
          </div>

          <button type="button" class="mg-edit-name" title="Edit name">
            <i class="fa-solid fa-pen-to-square"></i>
          </button>

          <!-- Crew affiliation -->
          {{#if system.crewName}}
            <div class="mg-crew-affiliation">
              <span class="crew-name">{{system.crewName}}</span>
            </div>
          {{else}}
            <div class="mg-crew-affiliation is-empty">
              <span class="crew-name">No Crew</span>
            </div>
          {{/if}}


          <div class="guise-display">
            <span class="guise-name">
              {{#if guise}}
              <span class="guise-name" data-tooltip="{{guise.system.description}}">
                <span class="level">Lv {{actor.system.level}}</span> {{guise.name}}
              </span>
              {{else}}
                No Class Assigned
              {{/if}}
            </span>
          </div>
        </div>

        <div class="side-controls">
          <button type="button" data-tooltip="Recover" class="long-rest-button">Recover <i class="fas fa-bed"></i></button>

          <div class="flashback-track">
            <label data-tooltip="Use this to spend a flashback during a job.">Flashback</label>
            <span class="flashback-dot {{#unless actor.system.flashbackUsed}}filled{{/unless}}" data-action="flashback">
              <i class="fa-solid fa-clock-rotate-left"></i>
            </span>
          </div>

          <div class="load-toggle">
            <label>Load</label>
            <div class="load-options">
              <span class="load-icon {{#if (eq actor.system.load 'light')}}selected{{/if}}" data-load="light" title="Light Load"><i class="fa-solid fa-feather-pointed"></i></span>
              <span class="load-icon {{#if (eq actor.system.load 'medium')}}selected{{/if}}" data-load="medium" title="Medium Load"><i class="fa-solid fa-scale-balanced"></i></span>
              <span class="load-icon {{#if (eq actor.system.load 'heavy')}}selected{{/if}}" data-load="heavy" title="Heavy Load"><i class="fa-solid fa-weight-hanging"></i></span>
            </div>
          </div>
        </div>
      </div>

      <div class="profile-image" data-tooltip="Click to Change Profile Image">
        <img class="mg-profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" />
      </div>
    </div>

    <section class="tab-content" data-group="main">
      
      <!--This is our General tab where Image, and general gameplay goes-->
      <div class="tab" data-group="main" data-tab="general" >
        
        <div class="attribute-container">
          {{#each attributeKeys as |key|}}
            <div class="attribute-row">
              <label>{{key}}</label>
              <span class="attribute-modifier"
                    data-tooltip="Click to roll | Right click to edit base Attribute"
                    data-key="{{key}}"
                    data-base="{{lookup ../system.baseAttributes key}}">
                {{#if (gte (lookup ../system.attributes key) 0)}}
                  +{{lookup ../system.attributes key}}
                {{else}}
                  {{lookup ../system.attributes key}}
                {{/if}}
              </span>
            </div>
          {{/each}}
        </div>

        <div class="strain-container">

          <label class="strain-label">Strain</label>

          <div class="capacity-box">
            <label data-tooltip="Physical damage affects this pool before your main tracks.">MC</label>
            <input
              type="number"
              name="system.strain.mortal capacity"
              value="{{lookup actor.system.strain 'mortal capacity'}}"
              min="0"
              data-tooltip="Physical damage affects this pool before your main tracks." />
          </div>

          <div class="capacity-box soul">
            <label data-tooltip="Supernatural or emotional damage affects this pool before your main tracks.">SC</label>
            <input
              type="number"
              name="system.strain.soul capacity"
              value="{{lookup actor.system.strain 'soul capacity'}}"
              min="0"
              data-tooltip="Supernatural or emotional damage affects this pool before your main tracks." />
          </div>

          <div class="strain-track mortal" data-strain="mortal">
            <label>M</label>

            {{#range 1 5}}
              <span class="strain-dot {{#if (lte this ../actor.system.strain.mortal)}}filled{{/if}}"
                    data-value="{{this}}"
                    data-type="mortal">
                <i class="fa-solid fa-dagger"></i>
              </span>
            {{/range}}
          </div>

          <div class="strain-track soul" data-strain="soul">
            <label>S</label>

            {{#range 1 5}}
              <span class="strain-dot {{#if (lte this ../actor.system.strain.soul)}}filled{{/if}}"
                    data-value="{{this}}"
                    data-type="soul">
                <i class="fa-solid fa-moon-over-sun"></i>
              </span>
            {{/range}}
          </div>
        </div>

        {{#if (or data.isFullCaster data.isHalfCaster)}}
          <div class="spark-container">
            <label class="spark-label" data-tooltip="Spark slots represent mystical charges or energy. Click to spend or restore.">Sparks</label>

            {{#if data.isFullCaster}}
              <div class="spark-school-selectors">
                <label for="sparkSchool1">Schools</label>
                <select id="spark-school-1" name="system.sparkSchool1">
                  <option value="">-- Select --</option>
                  <option value="veiling" {{#if (eq system.sparkSchool1 "veiling")}}selected{{/if}}>Veiling</option>
                  <option value="sundering" {{#if (eq system.sparkSchool1 "sundering")}}selected{{/if}}>Sundering</option>
                  <option value="binding" {{#if (eq system.sparkSchool1 "binding")}}selected{{/if}}>Binding</option>
                  <option value="drift" {{#if (eq system.sparkSchool1 "drift")}}selected{{/if}}>Drift</option>
                  <option value="threading" {{#if (eq system.sparkSchool1 "threading")}}selected{{/if}}>Threading</option>
                  <option value="warding" {{#if (eq system.sparkSchool1 "warding")}}selected{{/if}}>Warding</option>
                  <option value="shaping" {{#if (eq system.sparkSchool1 "shaping")}}selected{{/if}}>Shaping</option>
                  <option value="gloom" {{#if (eq system.sparkSchool1 "gloom")}}selected{{/if}}>Gloom</option>
                  <option value="ember" {{#if (eq system.sparkSchool1 "ember")}}selected{{/if}}>Ember</option>
                </select>

                <select id="spark-school-2" class="spark-select" name="system.sparkSchool2">
                  <option value="">-- Select --</option>
                  <option value="veiling" {{#if (eq system.sparkSchool2 "veiling")}}selected{{/if}}>Veiling</option>
                  <option value="sundering" {{#if (eq system.sparkSchool2 "sundering")}}selected{{/if}}>Sundering</option>
                  <option value="binding" {{#if (eq system.sparkSchool2 "binding")}}selected{{/if}}>Binding</option>
                  <option value="drift" {{#if (eq system.sparkSchool2 "drift")}}selected{{/if}}>Drift</option>
                  <option value="threading" {{#if (eq system.sparkSchool2 "threading")}}selected{{/if}}>Threading</option>
                  <option value="warding" {{#if (eq system.sparkSchool2 "warding")}}selected{{/if}}>Warding</option>
                  <option value="shaping" {{#if (eq system.sparkSchool2 "shaping")}}selected{{/if}}>Shaping</option>
                  <option value="gloom" {{#if (eq system.sparkSchool2 "gloom")}}selected{{/if}}>Gloom</option>
                  <option value="ember" {{#if (eq system.sparkSchool2 "ember")}}selected{{/if}}>Ember</option>
                </select>

              </div>

            {{else if data.isHalfCaster}}
              <div class="spark-school-selectors">
                <label for="sparkSchool1">Spark School</label>
                <select class="spark-select" name="system.sparkSchool1">
                  <option value="">-- Select --</option>
                  <option value="veiling" {{#if (eq system.sparkSchool1 "veiling")}}selected{{/if}}>Veiling</option>
                  <option value="sundering" {{#if (eq system.sparkSchool1 "sundering")}}selected{{/if}}>Sundering</option>
                  <option value="binding" {{#if (eq system.sparkSchool1 "binding")}}selected{{/if}}>Binding</option>
                  <option value="drift" {{#if (eq system.sparkSchool1 "drift")}}selected{{/if}}>Drift</option>
                  <option value="threading" {{#if (eq system.sparkSchool1 "threading")}}selected{{/if}}>Threading</option>
                  <option value="warding" {{#if (eq system.sparkSchool1 "warding")}}selected{{/if}}>Warding</option>
                  <option value="shaping" {{#if (eq system.sparkSchool1 "shaping")}}selected{{/if}}>Shaping</option>
                  <option value="gloom" {{#if (eq system.sparkSchool1 "gloom")}}selected{{/if}}>Gloom</option>
                  <option value="ember" {{#if (eq system.sparkSchool1 "ember")}}selected{{/if}}>Ember</option>
                </select>
              </div>
            {{/if}}

            {{#if (or data.isFullCaster data.isHalfCaster)}}
              <div class="spark-track" data-resource="spark">
                <div class="spark-boxes">
                  <label>Slots</label>
                  <div class="box-container">
                    {{#range 1 actor.system.sparkSlots}}
                      <span class="spark-dot {{#if (sparkShouldFill this ../actor.system.sparkSlots ../actor.system.sparkUsed)}}filled{{/if}}"
                            data-value="{{this}}">
                        <i class="fa-solid fa-dice-d10"></i>
                      </span>
                    {{/range}}
                  </div>
                </div>
              </div>
            {{/if}}
          </div>
        {{/if}}

        <div class="skills">
          <div class="skills-header">
            <label class="skills-label">Skills</label>

            <div class="risk-track" data-resource="risk">
              <label data-tooltip="Risk Dice represent your luck pool. Click to spend or restore.">Risk</label>
              <div class="risk-boxes">
                {{#range 1 actor.system.riskDice}}
                  <span class="risk-dot {{#if (riskShouldFill this ../actor.system.riskDice ../actor.system.riskUsed)}}filled{{/if}}"
                        data-value="{{this}}">
                    <i class="fa-solid fa-dice"></i>
                  </span>
                {{/range}}
              </div>
            </div>
          </div>

          <div class="skill-container">
            {{#each system.skills as |value key|}}
              <div class="skill-row">
                <span class="skill-value" data-key="{{key}}" data-base="{{value}}">
                  {{value}}
                </span>

                <span class="skill-name" data-key="{{key}}">
                  <span class="skill-key">{{key}}</span>
                  <span class="skill-attr">({{lookup ../skillAttrShort key}})</span>
                </span>
              </div>
            {{/each}}
          </div>
        </div>
      </div>

      <!--This is our Moves tab. It shows Signature Perk, and moves on the character sheet-->
      <div class="tab tab-moves" data-tab="moves">
        {{#if guise}}
          <div class="signature-perk">
            <h3>
              <span class="post-signature" data-perk-name="{{guise.system.signaturePerk}}" data-perk-description="{{guise.system.signatureDescription}}">
                <i class="fa-solid fa-messages"></i>Signature Perk: {{guise.system.signaturePerk}}
              </span>
            </h3>
            <p>{{guise.system.signatureDescription}}</p>
          </div>


          <div class="basic-moves">
            <h3>Basic Moves</h3>
            <div class="move-container">
              {{#each guise.system.moves}}
                <div class="move-block" data-move-index="{{@index}}">
                  <strong class="post-move" data-move-name="{{this.name}}" data-move-description="{{this.description}}">
                    <i class="fa-solid fa-messages"></i>{{this.name}}
                  </strong>
                  <p>{{this.description}}</p>
                </div>
              {{/each}}
            </div>
          </div>
        {{else}}
          <p>No guise assigned. Assign one to gain moves.</p>
        {{/if}}

      <div class="moves-section">
        <h3>Learned Moves</h3>
        <div class="moves-grid" data-move-list>
          {{#each actor.items as |item|}}
            {{#if (eq item.type "move")}}
            <div class="move-block" data-item-id="{{item._id}}" draggable="true">
              <header class="move-header">
                <span
                  class="move-name post-move"
                  data-move-name="{{item.name}}"
                  data-move-description="{{item.system.description}}"
                >
                  <i class="fa-solid fa-messages"></i>
                  {{item.name}}
                </span>
              </header>
              <div class="moves-wrapper">
                <div class="move-desc">{{{item.system.description}}}</div>
                <button type="button" class="delete-move" title="Remove Move">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
            {{/if}}
          {{/each}}
        </div>
      </div>

      </div>

      <!--This is our Deck, and currently drawn Gambits-->
      <div class="tab tab-gambits" data-group="main" data-tab="gambits">
        <div class="gambit-tab">

          <div class="gambit-settings">
            <button type="button" class="draw-gambit"><i class="fa-solid fa-cards"></i> Draw Card</button>
            <button type="button" class="reset-gambit-deck"><i class="fa-solid fa-arrows-spin"></i> Reset Deck</button>
          </div>

          <div class="gambit-hand">
            
            <span class="hand-size gambit-counter" title="Cards in hand / hand limit">
              Hand Size: {{gambitCounts.handCount}}/{{gambitCounts.handMax}}
            </span>

            <h2 class="gambit-banner">Hand</h2>
            {{#each gambitDrawn}}
              <div class="gambit-card drawn" data-source="drawn" draggable="true" data-item-id="{{_id}}">

                <div class="gambit-title">
                  <button type="button" class="post-gambit" data-item-id="{{_id}}" title="Post to Chat">
                    <i class="fa-solid fa-messages"></i>
                    {{name}}
                  </button>
                </div>

                <div class="gambit-wrapper">
                  <div class="gambit-description">
                    {{{system.description}}}
                  </div>

                  <div class="status-buttons">
                    <button type="button" class="play-gambit" data-item-id="{{_id}}" title="Play Gambit">
                      <i class="fa-solid fa-play"></i>
                    </button>
                    <button type="button" class="return-to-deck" data-item-id="{{_id}}" title="Return to Deck">
                      <i class="fa-solid fa-rotate-left"></i>
                    </button>
                  </div>
                </div>
              </div>
            {{/each}}
          </div>

          <div class="gambit-deck">
            <h2 class="gambit-banner">Deck</h2>

            <span class="deck-size gambit-counter" title="Cards in deck / deck capacity">
              Deck Size: {{gambitCounts.deckCount}}/{{gambitCounts.deckMax}}
            </span>

            {{#each gambitDeck}}
              <div class="gambit-card" data-source="deck" draggable="true" data-item-id="{{_id}}">

                <div class="gambit-title">
                  <button type="button" class="post-gambit" data-item-id="{{_id}}" title="Post to Chat">
                    <i class="fa-solid fa-message"></i>
                    {{name}}
                  </button>
                </div>


                <div class="gambit-wrapper">
                  <div class="gambit-description">
                    {{{system.description}}}
                  </div>

                  <div class="status-buttons">
                    <button type="button" class="discard-card" data-item-id="{{_id}}" title="Discard"><i class="fa-solid fa-recycle"></i></button>
                    <button type="button" class="remove-from-hand" data-item-id="{{_id}}" title="Remove from Deck"><i class="fa-solid fa-delete-left"></i></button>
                  </div>
                </div>
              </div>
            {{/each}}
          </div>

          <div class="gambit-discard">
            <h2 class="gambit-banner">Discard</h2>
            {{#each gambitDiscard}}
              <div class="gambit-card faded" data-source="discard" draggable="false" data-item-id="{{_id}}">
                <div class="gambit-title">{{name}}</div>
                <div class="gambit-description">
                  {{{system.description}}}
                </div>
              </div>
            {{/each}}
          </div>
        </div>
      </div>

      <!--This is our Inventory with Lux and eventually Search-->
      <div class="tab tab-inventory" data-group="main" data-tab="inventory">
        <div class="inventory-tab">

          <div class="currency-field">
            <label for="lux"><i class="fa-solid fa-coins"></i>Lux</label>
            <input type="number" name="system.currency.lux" value="{{actor.system.currency.lux}}" min="0" />
          </div>

          <!--We will add search back in the future
          <div class="search-field">
            <input type="text" id="item-search" placeholder="Search items..." />
          </div>-->

          <!-- Weapons -->
          <div class="inventory-section weapons">
            <div class="inventory-wrapper">
              <h3>Weapons</h3>
              <div class="inventory-header">
                <span>Name</span>
                <span>DMG</span>
                <span>Qty</span>
                <span>Equipped</span>
                <span>Tags</span>
              </div>
            </div>

            <!-- Weapons - Item -->
            {{#each (filterItems @root.actor.items "weapon") as |item|}}
              <div class="inventory-item" data-item-id="{{item._id}}">
                <span class="item-name">
                  <span class="clickable-item">{{item.name}}</span>
                  <button class="post-weapon-tags" data-item-id="{{item._id}}" title="Post Weapon Tags to Chat">
                    <i class="fas fa-tags"></i>
                  </button>
                </span>

                {{#if item.system.strainDamage}}
                  <div class="item-capacity" title="Strain Damage">
                    <p class="strain-damage">
                      <span>SD</span> 
                      <span class="remaining-number">{{item.system.strainDamage}}</span>
                    </p>
                  </div>
                {{/if}}

                <span><input type="number" class="item-quantity" value="{{item.system.quantity}}" min="0" /></span>

                <span><input type="checkbox" class="item-equipped" {{#if item.system.equipped}}checked{{/if}} /></span>

                <span class="item-tags">
                  {{#each item.system.tags as |tagId|}}
                    {{#with (lookup ../../CONFIG.MidnightGambit.ITEM_TAGS tagId) as |tag|}}
                      <div class="item-tag tag" data-item-id="{{item._id}}" data-tag-id="{{tagId}}" title="Right-click to remove">
                        <span data-tooltip="{{tag.description}}">{{tag.label}}</span>
                      </div>
                    {{else}}

                      <div class="item-tag tag" data-item-id="{{item._id}}" data-tag-id="{{tagId}}" title="Right-click to remove">
                        <span>{{tagId}}</span>
                      </div>

                    {{/with}}
                  {{/each}}
                </span>

                <div class="status-buttons">

                  <button class="sync-tags" data-item-id="{{_id}}" title="Sync tags with global list">
                    <i class="fa-solid fa-arrows-rotate"></i>
                  </button>

                  <button class="item-delete" data-item-id="{{item._id}}" title="Delete Item">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>

              </div>
            {{/each}}
          </div>

          <!-- Armor -->
          <div class="inventory-section armor">

            <div class="inventory-wrapper">

              <h3>Armor</h3>

              <div class="inventory-header">
                <span>Name</span>
                <span>Capacity</span>
                <span>Qty</span>
                <span>Equipped</span>
                <span>Tags</span>
              </div>

            </div>

            <!-- Armor - Item -->
            {{#each (filterItems @root.actor.items "armor") as |item|}}
              <div class="inventory-item" data-item-id="{{item._id}}">
                <span class="item-name">
                  <span class="clickable-item">{{item.name}}</span>
                  <button class="post-armor-tags" data-item-id="{{item._id}}" title="Post Armor Tags to Chat">
                    <i class="fas fa-tags"></i>
                  </button>
                </span>

                <div class="item-capacity" title="Remaining Strain Capacity">
                  <p class="mortal-remain"><span>MC</span><span class="remaining-number">{{item.system.remainingCapacity.mortal}}</span></p><p class="soul-remain"><span>SC</span><span class="remaining-number">{{item.system.remainingCapacity.soul}}</span></p>
                </div>

                <span><input type="number" class="item-quantity" value="{{item.system.quantity}}" min="0" /></span>
                <span><input type="checkbox" class="item-equipped" {{#if item.system.equipped}}checked{{/if}} /></span>
                <span class="item-tags">
                  {{#each item.system.tags as |tagId|}}
                    {{#with (lookup ../../CONFIG.MidnightGambit.ITEM_TAGS tagId) as |tag|}}
                      <div class="item-tag tag" data-item-id="{{item._id}}" data-tag-id="{{tagId}}" title="Right-click to remove">
                        <span data-tooltip="{{tag.description}}">{{tag.label}}</span>
                      </div>
                    {{else}}
                      <div class="item-tag tag" data-item-id="{{item._id}}" data-tag-id="{{tagId}}" title="Right-click to remove">
                        <span>{{tagId}}</span>
                      </div>
                    {{/with}}
                  {{/each}}
                </span>

                <div class="status-buttons">
                  {{#if (or item.system.mortalCapacity item.system.soulCapacity)}}

                    {{#if item.system.isFullyRepaired}}
                      <button class="repair-armor disabled" data-item-id="{{item._id}}" title="Fully Repaired" disabled>
                        <i class="fa-solid fa-hammer"></i>
                      </button>
                    {{else}}
                      <button class="repair-armor" data-item-id="{{item._id}}" title="Repair Item">
                        <i class="fa-solid fa-hammer"></i>
                      </button>
                    {{/if}}
                  {{/if}}

                  <button class="sync-tags" data-item-id="{{_id}}" title="Sync tags with global list">
                    <i class="fa-solid fa-arrows-rotate"></i>
                  </button>

                  <button class="item-delete" data-item-id="{{item._id}}" title="Delete Item">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>

              </div>
            {{/each}}

          </div>

          <!-- Misc -->
          <div class="inventory-section misc">
            <div class="inventory-wrapper">
              <h3>Misc</h3>
              <div class="inventory-header">
                <span>Name</span>
                <span>DMG / Capacity</span>
                <span>Qty</span>
                <span>Equipped</span>
                <span>Tags</span>
              </div>
            </div>

            <!-- Misc - Item -->
            {{#each (filterItems @root.actor.items "misc") as |item|}}
              <div class="inventory-item" data-item-id="{{item._id}}">
                <span class="item-name">
                  <span class="clickable-item">{{item.name}}</span>

                  <button class="post-misc-tags" data-item-id="{{item._id}}" title="Post Misc Tags to Chat">
                    <i class="fas fa-tags"></i>
                  </button>
                </span>

                <span class="item-capacity" title="Strain Effects">

                  <p class="strain-damage">
                    <span>SD</span> 
                    <span class="remaining-number">
                      {{#if (ne item.system.strainDamage undefined)}}
                        {{item.system.strainDamage}}
                      {{else}} -
                      {{/if}}
                    </span>
                  </p>

                  <p class="mortal-remain">
                    <span>MC</span>
                    <span class="remaining-number">
                      {{#if (ne item.system.remainingCapacity.mortal undefined)}}
                        {{item.system.remainingCapacity.mortal}}
                      {{else}} -
                      {{/if}}
                    </span>
                  </p>

                  <p class="soul-remain">
                    <span>SC</span>
                    <span class="remaining-number">
                      {{#if (ne item.system.remainingCapacity.soul undefined)}}
                        {{item.system.remainingCapacity.soul}}
                      {{else}} -
                      {{/if}}
                    </span>
                  </p>

                </span>


                <span><input type="number" class="item-quantity" value="{{item.system.quantity}}" min="0" /></span>
                <span><input type="checkbox" class="item-equipped" {{#if item.system.equipped}}checked{{/if}} /></span>

                <span class="item-tags">
                  {{#each item.system.tags as |tagId|}}
                    {{#with (lookup ../../CONFIG.MidnightGambit.ITEM_TAGS tagId) as |tag|}}
                      <div class="item-tag tag" data-item-id="{{item._id}}" data-tag-id="{{tagId}}" title="Right-click to remove">
                        <span data-tooltip="{{tag.description}}">{{tag.label}}</span>
                      </div>
                    {{else}}
                      <div class="item-tag tag" data-item-id="{{item._id}}" data-tag-id="{{tagId}}" title="Right-click to remove">
                        <span>{{tagId}}</span>
                      </div>
                    {{/with}}
                  {{/each}}
                </span>

                <div class="status-buttons">
                  {{#if (or item.system.mortalCapacity item.system.soulCapacity)}}

                    {{#if item.system.isFullyRepaired}}
                      <button class="repair-armor disabled" data-item-id="{{item._id}}" title="Fully Repaired" disabled>
                        <i class="fa-solid fa-hammer"></i>
                      </button>
                    {{else}}
                      <button class="repair-armor" data-item-id="{{item._id}}" title="Repair Item">
                        <i class="fa-solid fa-hammer"></i>
                      </button>
                    {{/if}}
                  {{/if}}

                  <button class="sync-tags" data-item-id="{{_id}}" title="Sync tags with global list">
                    <i class="fa-solid fa-arrows-rotate"></i>
                  </button>

                  <button class="item-delete" data-item-id="{{item._id}}" title="Delete Item">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>

              </div>
            {{/each}}

          </div>
        </div>
      </div>

      <!--This is our journal for character information/backstory-->
      <div class="tab  journal-tab" data-group="main" data-tab="journal">
        <div class="journal-fields">
          <div class="field-pair">
            <label>Race</label>
            <input type="text" name="system.journal.race" value="{{actor.system.journal.race}}" />
          </div>

          <div class="field-pair">
            <label>Sex</label>
            <input type="text" name="system.journal.sex" value="{{actor.system.journal.sex}}" />
          </div>

          <div class="field-pair">
            <label>Appearance</label>
            <textarea name="system.journal.appearance">{{actor.system.journal.appearance}}</textarea>
          </div>

          <div class="field-pair">
            <label>Traits</label>
            <textarea name="system.journal.traits">{{actor.system.journal.traits}}</textarea>
          </div>

          <div class="field-pair">
            <label>Ideals</label>
            <textarea name="system.journal.ideals">{{actor.system.journal.ideals}}</textarea>
          </div>

          <div class="field-pair">
            <label>Bonds</label>
            <textarea name="system.journal.bonds">{{actor.system.journal.bonds}}</textarea>
          </div>

          <div class="field-pair">
            <label>Flaws</label>
            <textarea name="system.journal.flaws">{{actor.system.journal.flaws}}</textarea>
          </div>
        </div>

      </div>

      <div class="tab settings-tab" data-group="main" data-tab="settings">
        {{#if hasActiveGuise}}
          <div class="level-controls">
            <button type="button" class="mg-level-up {{#unless canLevelUp}}disabled{{/unless}}">
              <i class="fa-solid fa-angles-up"></i> Level Up
            </button>
            <button type="button" class="mg-undo-level {{#unless canLevelDown}}disabled{{/unless}}">
              <i class="fa-solid fa-rotate-left"></i> Undo Level
            </button>
          </div>
        {{else}}
          <section class="level-controls disabled">
            <div class="mg-muted">Drop a Guise onto your sheet to enable leveling.</div>
          </section>
        {{/if}}

        <div class="mg-content">
          <h2>Profile Image</h2>

          <div class="button-wrapper">
            <button type="button" class="mg-change-profile-image">
              <i class="fa-solid fa-image"></i>
              Change Profile Image
            </button>

            <button type="button" class="mg-crop-profile">
              <i class="fa-solid fa-crop"></i> Crop Actor Profile Image
            </button>
          </div>
          
        </div>

        <div class="guise-display mg-content">
          <h3>Remove Guise</h2>
          <p>Only do this if you have a glitch, or need to rework your character!</p>
          
          <span class="guise-name">
            {{#if guise}}
              <button type="button" class="remove-guise" title="Remove Guise">Remove Guise</button>
            {{else}}
              No Class Assigned
            {{/if}}
          </span>
        </div>
      </div>


    </section>
  </div>
</form>